"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[477],{6477:(e,l,t)=>{t.r(l),t.d(l,{default:()=>d});var s=t(8045),n=t(5177),a=t(8450),r=t(1312),i=t(6287);function c(e){let{ok:l,title:t}=e;return(0,s.jsx)("span",{title:t,className:"inline-flex h-3 w-3 rounded-full ring-2 ring-white shadow-sm transition-all duration-200 ".concat(l?"bg-success-500 animate-pulse-slow":"bg-slate-300")})}function o(e){let{value:l,max:t=4e3}=e,n=Math.max(0,Math.min(100,Math.round(l/t*100)));return(0,s.jsx)("div",{className:"w-28 h-3 bg-slate-200 rounded-full overflow-hidden shadow-inner",children:(0,s.jsx)("div",{className:"h-full rounded-full transition-all duration-500 ease-out ".concat(n>=70?"bg-gradient-to-r from-success-400 to-success-500":n>=30?"bg-gradient-to-r from-warning-400 to-warning-500":"bg-gradient-to-r from-danger-400 to-danger-500"),style:{width:"".concat(n,"%")}})})}function d(e){let{initialIntervalMs:l=8e3}=e,[t,d]=(0,n.useState)(null),[u,h]=(0,n.useState)(null),[m,x]=(0,n.useState)(()=>Date.now()),[p,g]=(0,n.useState)(!1),[f,j]=(0,n.useState)(l),v=(0,n.useRef)(null),N=async()=>{try{let e=await (0,a.V)("/api/wialon?action=positionsNow");d(e),h(null),x(Date.now())}catch(e){h(e.message||String(e))}};(0,n.useEffect)(()=>{g(!0),N()},[]),(0,n.useEffect)(()=>(v.current&&clearInterval(v.current),v.current=setInterval(N,f),()=>{v.current&&clearInterval(v.current)}),[f]);let b=Array.isArray(null==t?void 0:t.items)?t.items:[],w=(0,n.useMemo)(()=>b.map(e=>{var l,t,s,n,a,r;let i=(null==e?void 0:e.pos)||(null==e||null==(l=e.lmsg)?void 0:l.pos),c=null!=(s=null==e||null==(t=e.lmsg)?void 0:t.p)?s:{},o=null==i?void 0:i.y,d=null==i?void 0:i.x,u=null!=(n=null==i?void 0:i.s)?n:0,h=null!=(a=null==c?void 0:c.io_270)?a:null,m=null!=(r=null==c?void 0:c.io_273)?r:null;return{u:e,p:i,io:c,lat:o,lon:d,speed:u,fuelA:h,fuelB:m}}),[b]);return(0,s.jsxs)(r.A,{title:"Live positions",toolbar:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("select",{className:"text-sm border rounded px-2 py-1",value:f,onChange:e=>j(Number(e.target.value)),title:"Refresh interval",children:[(0,s.jsx)("option",{value:5e3,children:"5s"}),(0,s.jsx)("option",{value:1e4,children:"10s"}),(0,s.jsx)("option",{value:3e4,children:"30s"}),(0,s.jsx)("option",{value:6e4,children:"60s"})]}),(0,s.jsx)("button",{className:"text-sm underline",onClick:N,children:"Refresh"}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",suppressHydrationWarning:!0,children:["Updated ",p?new Date(m).toLocaleTimeString("en-ZA",{timeZone:"Africa/Johannesburg"}):""]})]}),children:[u&&(0,s.jsx)(i.A,{message:u}),(0,s.jsx)("div",{className:"overflow-auto border rounded",children:(0,s.jsxs)("table",{className:"min-w-[900px] text-sm",children:[(0,s.jsx)("thead",{className:"sticky top-0 bg-white shadow-[inset_0_-1px_0_0_rgba(0,0,0,0.06)]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left p-2",children:"Unit"}),(0,s.jsx)("th",{className:"text-left p-2",children:"Speed"}),(0,s.jsx)("th",{className:"text-left p-2",children:"Coords"}),(0,s.jsx)("th",{className:"text-left p-2",children:"Heading"}),(0,s.jsx)("th",{className:"text-left p-2",children:"Fuel A/B"}),(0,s.jsx)("th",{className:"text-left p-2",children:"Open"})]})}),(0,s.jsxs)("tbody",{className:"[&>tr:nth-child(odd)]:bg-gray-50/50",children:[w.map(e=>{var l,t,n;let{u:a,p:r,lat:i,lon:d,speed:u,fuelA:h,fuelB:m}=e;return(0,s.jsxs)("tr",{className:"border-t hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("td",{className:"p-2",children:null!=(t=null!=(l=null==a?void 0:a.nm)?l:null==a?void 0:a.name)?t:null==a?void 0:a.id}),(0,s.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,s.jsx)(c,{ok:(null!=u?u:0)>0,title:(null!=u?u:0)>0?"Moving":"Idle"}),null!=u?u:0," km/h"]}),(0,s.jsx)("td",{className:"p-2",children:"number"==typeof i&&"number"==typeof d?"".concat(i.toFixed(6),", ").concat(d.toFixed(6)):"—"}),(0,s.jsx)("td",{className:"p-2",children:null!=(n=null==r?void 0:r.c)?n:"—"}),(0,s.jsx)("td",{className:"p-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(o,{value:"number"==typeof h?h:0}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:[null!=h?h:"—"," / ",null!=m?m:"—"]})]})}),(0,s.jsx)("td",{className:"p-2",children:"number"==typeof i&&"number"==typeof d?(0,s.jsx)("a",{className:"underline",href:"https://www.openstreetmap.org/?mlat=".concat(i,"&mlon=").concat(d,"#map=12/").concat(i,"/").concat(d),target:"_blank",rel:"noreferrer",children:"OSM"}):"—"})]},null==a?void 0:a.id)}),0===w.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"p-2",colSpan:6,children:"No positions"})})]})]})})]})}}}]);