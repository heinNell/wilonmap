(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{691:(e,t,n)=>{"use strict";function l(e){let{reason:t,children:n}=e;return n}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return l}}),n(967)},1312:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var l=n(8045);function r(e){let{title:t,toolbar:n,children:r,className:s=""}=e;return(0,l.jsxs)("section",{className:"bg-white/70 backdrop-blur-sm border border-white/60 rounded-2xl shadow-card hover:shadow-card-hover transition-all duration-300 p-6 ".concat(s),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3 mb-6",children:[(0,l.jsxs)("h2",{className:"text-xl font-semibold text-slate-800 flex items-center gap-2",children:[(0,l.jsx)("div",{className:"h-1.5 w-1.5 bg-primary-500 rounded-full"}),t]}),n&&(0,l.jsx)("div",{className:"flex items-center gap-3 text-sm",children:n})]}),r]})}},1438:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return l}});let l=(0,n(6576).createAsyncLocalStorage)()},1582:(e,t,n)=>{"use strict";n.d(t,{default:()=>d});var l=n(8045),r=n(5177),s=n(8450),a=n(1312),i=n(6287);let o=(0,n(3775).default)(()=>n.e(579).then(n.bind(n,5579)),{loadableGenerated:{webpack:()=>[5579]},ssr:!1,loading:()=>(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"Loading toolbar…"})});function d(){let[e,t]=(0,r.useState)(null),[n,d]=(0,r.useState)(null),[u,f]=(0,r.useState)(!0),[m,h]=(0,r.useState)(""),[x,p]=(0,r.useState)("name"),b=async()=>{try{let e=await (0,s.V)("/api/wialon?action=positionsNow");t(e),d(null)}catch(e){d(e.message||String(e))}finally{f(!1)}};(0,r.useEffect)(()=>{b()},[]);let j=(0,r.useMemo)(()=>{let t=(Array.isArray(null==e?void 0:e.items)?e.items:[]).map(e=>{var t,n,l,r,s,a,i,o;let d=(null==e?void 0:e.pos)||(null==e||null==(t=e.lmsg)?void 0:t.pos),c=null!=(l=null==e||null==(n=e.lmsg)?void 0:n.p)?l:{},u=null!=(s=null!=(r=null==e?void 0:e.nm)?r:null==e?void 0:e.name)?s:"";return{u:e,name:u,speed:null!=(a=null==d?void 0:d.s)?a:0,fuel:(null!=(i=null==c?void 0:c.io_270)?i:0)+(null!=(o=null==c?void 0:c.io_273)?o:0)}});return[...m?t.filter(e=>e.name.toLowerCase().includes(m.toLowerCase())):t].sort((e,t)=>{var n,l,r,s;return"name"===x?e.name.localeCompare(t.name):"speed"===x?(null!=(n=t.speed)?n:0)-(null!=(l=e.speed)?l:0):(null!=(r=t.fuel)?r:0)-(null!=(s=e.fuel)?s:0)})},[e,m,x]);return(0,l.jsxs)(a.A,{title:"Units",toolbar:(0,l.jsx)(o,{onQuery:h,onSort:p,refresh:b}),children:[u&&(0,l.jsx)("p",{children:"Loading…"}),n&&(0,l.jsx)(i.A,{message:n}),!u&&!n&&(0,l.jsx)("div",{className:"overflow-auto border rounded",children:(0,l.jsxs)("table",{className:"min-w-[760px] text-sm",children:[(0,l.jsx)("thead",{className:"sticky top-0 bg-white shadow-[inset_0_-1px_0_0_rgba(0,0,0,0.06)]",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"text-left p-2",children:"#"}),(0,l.jsx)("th",{className:"text-left p-2",children:"Name"}),(0,l.jsx)("th",{className:"text-left p-2",children:"ID"}),(0,l.jsx)("th",{className:"text-left p-2",children:"Speed"}),(0,l.jsx)("th",{className:"text-left p-2",children:"Fuel (sum)"}),(0,l.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,l.jsxs)("tbody",{className:"[&>tr:nth-child(odd)]:bg-gray-50/50",children:[j.map((e,t)=>{var n,r,s,a,i,o,d;return(0,l.jsxs)("tr",{className:"border-t hover:bg-gray-50 transition-colors",children:[(0,l.jsx)("td",{className:"p-2",children:t+1}),(0,l.jsx)("td",{className:"p-2",children:e.name||"(no name)"}),(0,l.jsx)("td",{className:"p-2",children:null!=(a=null==(n=e.u)?void 0:n.id)?a:"—"}),(0,l.jsxs)("td",{className:"p-2",children:[null!=(i=e.speed)?i:0," km/h"]}),(0,l.jsx)("td",{className:"p-2",children:null!=(o=e.fuel)?o:0}),(0,l.jsx)("td",{className:"p-2",children:(0,l.jsx)(c,{unitId:null==(r=e.u)?void 0:r.id})})]},null!=(d=null==(s=e.u)?void 0:s.id)?d:t)}),0===j.length&&(0,l.jsx)("tr",{children:(0,l.jsx)("td",{className:"p-2",colSpan:6,children:"No units"})})]})]})})]})}function c(e){let{unitId:t}=e,[n,a]=(0,r.useState)(!1);return(0,l.jsx)("button",{className:"border px-2 py-1 rounded",disabled:!t||n,onClick:async()=>{try{a(!0);let e=await (0,s.V)("/api/wialon?action=unitById&unitId=".concat(t));alert("Unit ".concat(t," details:\n").concat(JSON.stringify(e,null,2).slice(0,2e3)))}catch(e){alert("Failed: ".concat(e.message||String(e)))}finally{a(!1)}},children:n?"Loading…":"Details"})}},3326:(e,t,n)=>{"use strict";function l(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return l}}),n(8045),n(4380),n(7269),n(7756)},3775:(e,t,n)=>{"use strict";n.d(t,{default:()=>r.a});var l=n(4020),r=n.n(l)},4020:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let l=n(6708)._(n(8436));function r(e,t){var n;let r={};"function"==typeof e&&(r.loader=e);let s={...r,...t};return(0,l.default)({...s,modules:null==(n=s.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6287:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var l=n(8045);function r(e){let{message:t}=e;return(0,l.jsxs)("div",{className:"flex items-start gap-3 text-sm text-danger-700 bg-gradient-to-r from-danger-50 to-danger-100 border border-danger-200 p-4 rounded-xl animate-slide-up",children:[(0,l.jsx)("svg",{className:"h-5 w-5 text-danger-500 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:"Error occurred"}),(0,l.jsx)("p",{className:"text-danger-600 mt-1",children:t})]})]})}},6566:(e,t,n)=>{"use strict";n.d(t,{default:()=>s});var l=n(8045);let r=(0,n(3775).default)(()=>n.e(477).then(n.bind(n,6477)),{loadableGenerated:{webpack:()=>[6477]},ssr:!1,loading:()=>(0,l.jsx)("section",{className:"bg-white border rounded-xl shadow-sm p-4",children:(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Loading live positions…"})})});function s(){return(0,l.jsx)(r,{})}},6576:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{bindSnapshot:function(){return a},createAsyncLocalStorage:function(){return s},createSnapshot:function(){return i}});let n=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class l{disable(){throw n}getStore(){}run(){throw n}exit(){throw n}enterWith(){throw n}static bind(e){return e}}let r="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function s(){return r?new r:new l}function a(e){return r?r.bind(e):l.bind(e)}function i(){return r?r.snapshot():function(e,...t){return e(...t)}}},6862:(e,t,n)=>{Promise.resolve().then(n.bind(n,6566)),Promise.resolve().then(n.bind(n,8298)),Promise.resolve().then(n.bind(n,1582))},7269:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return l.workAsyncStorageInstance}});let l=n(1438)},8298:(e,t,n)=>{"use strict";n.d(t,{default:()=>s});var l=n(8045);let r=(0,n(3775).default)(()=>Promise.all([n.e(757),n.e(550),n.e(428)]).then(n.bind(n,6428)),{loadableGenerated:{webpack:()=>[6428]},ssr:!1,loading:()=>(0,l.jsx)("section",{className:"bg-white/70 backdrop-blur-sm border border-white/60 rounded-2xl shadow-card p-6",children:(0,l.jsxs)("div",{className:"h-[520px] w-full flex flex-col items-center justify-center text-slate-600 space-y-4",children:[(0,l.jsx)("div",{className:"relative",children:(0,l.jsx)("div",{className:"h-12 w-12 border-4 border-slate-200 border-t-primary-500 rounded-full animate-spin"})}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-sm font-medium",children:"Loading map..."}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"Initializing Leaflet components"})]})]})})});function s(){return(0,l.jsx)(r,{})}},8436:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let l=n(8045),r=n(5177),s=n(691);function a(e){return{default:e&&"default"in e?e.default:e}}n(3326);let i={loader:()=>Promise.resolve(a(()=>null)),loading:null,ssr:!0},o=function(e){let t={...i,...e},n=(0,r.lazy)(()=>t.loader().then(a)),o=t.loading;function d(e){let a=o?(0,l.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,d=i?r.Suspense:r.Fragment,c=t.ssr?(0,l.jsxs)(l.Fragment,{children:[null,(0,l.jsx)(n,{...e})]}):(0,l.jsx)(s.BailoutToCSR,{reason:"next/dynamic",children:(0,l.jsx)(n,{...e})});return(0,l.jsx)(d,{...i?{fallback:a}:{},children:c})}return d.displayName="LoadableComponent",d}},8450:(e,t,n)=>{"use strict";async function l(e,t){let n=await fetch(e,{...t,cache:"no-store"}),l=await n.json().catch(()=>({}));if(!n.ok){let e=(null==l?void 0:l.error)||"Request failed (".concat(n.status,")"),t=(null==l?void 0:l.body)||"";throw Error("".concat(e).concat(t?" — ".concat(String(t).slice(0,200),"…"):""))}return l}n.d(t,{V:()=>l})}},e=>{e.O(0,[986,143,358],()=>e(e.s=6862)),_N_E=e.O()}]);